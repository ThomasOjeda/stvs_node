import{b as q,c as E}from"./chunk-LRCNYBC7.js";import{d as H,e as Oe,f as Be,h as Ae}from"./chunk-X3P6VRX6.js";import{$ as K,A as n,Aa as ae,Ab as j,B as _,Ba as le,C as V,D as L,Da as me,Eb as Ne,F as x,Fa as se,Fb as Ve,G as f,Gb as Le,H as h,Ha as pe,I as z,J as G,K as Q,L as b,Lb as ke,M as a,N as F,O as k,Pa as ce,Qa as M,S as J,Sb as Re,U as $,W as U,Wa as O,Xa as de,aa as S,ab as ue,bb as fe,ca as Y,cb as _e,d as Z,ea as ee,gb as B,h as T,hb as he,j as v,jb as A,k as N,kb as P,mb as Fe,n as d,na as te,nb as we,o as u,ob as ge,pa as R,pb as Ce,qb as ve,rb as xe,s as l,sa as W,sb as be,t as w,ta as ie,tb as Se,ua as y,ub as ye,va as ne,vb as Me,w as c,wa as re,wb as Ee,x as s,xa as oe,xb as Ie,ya as I,yb as De,z as i,zb as Te}from"./chunk-XFNI64LT.js";var Je=()=>[15,30,45];function Ke(t,p){t&1&&(i(0,"th",14),a(1,"Nombre"),n())}function Ye(t,p){if(t&1&&(i(0,"td",15),a(1),n()),t&2){let e=p.$implicit;l(),F(e.name)}}function et(t,p){t&1&&(i(0,"th",14),a(1,"A\xF1o"),n())}function tt(t,p){if(t&1&&(i(0,"td",15),a(1),n()),t&2){let e=p.$implicit;l(),F(e.year)}}function it(t,p){t&1&&(i(0,"th",14),a(1,"Tipo"),n())}function nt(t,p){if(t&1&&(i(0,"td",15),a(1),n()),t&2){let e=p.$implicit;l(),F(e.type)}}function rt(t,p){t&1&&_(0,"tr",16)}function ot(t,p){if(t&1){let e=x();i(0,"tr",17),f("click",function(){let o=d(e).$implicit,m=h();return u(m.openDetails(o))}),n()}}function at(t,p){if(t&1&&(i(0,"tr",18)(1,"td",19),a(2),n()()),t&2){h();let e=b(4);l(2),k(' No se encontro un archivo con el filtro "',e.value,'" ')}}function lt(t,p){t&1&&_(0,"app-shade-loading-spinner")}var He=(()=>{class t{constructor(e,r){this.router=e,this.filesServ=r,this.columnsToDisplay=["name","type","year"],this.isLoadingResults=!0}ngOnInit(){this.newFileEvent.subscribe(e=>{e=="new"&&this.refresh()})}ngAfterViewInit(){this.dataSource=new Ie,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.refresh()}refresh(){this.isLoadingResults=!0,this.filesServ.getFiles().subscribe({next:e=>{this.dataSource.data=e.result},error:()=>{},complete:()=>{this.isLoadingResults=!1}})}applyFilter(e){let r=e.target.value;this.dataSource.filter=r.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}openDetails(e){this.router.navigate(["home","files",e._id])}static{this.\u0275fac=function(r){return new(r||t)(w(R),w(E))}}static{this.\u0275cmp=v({type:t,selectors:[["app-file-list"]],viewQuery:function(r,o){if(r&1&&(z(j,5),z(De,5)),r&2){let m;G(m=Q())&&(o.paginator=m.first),G(m=Q())&&(o.sort=m.first)}},inputs:{newFileEvent:"newFileEvent"},decls:22,vars:6,consts:[["input",""],["matInput","",3,"keyup"],["mat-table","",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","year"],["matColumnDef","type"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","row",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Seleccione pagina de archivos",3,"pageSizeOptions"],["mat-button","",3,"click"],[4,"ngIf"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"row",3,"click"],[1,"mat-row"],["colspan","3",1,"mat-cell"]],template:function(r,o){if(r&1){let m=x();i(0,"mat-form-field")(1,"mat-label"),a(2,"Filtrar"),n(),i(3,"input",1,0),f("keyup",function(C){return d(m),u(o.applyFilter(C))}),n()(),i(5,"table",2),V(6,3),c(7,Ke,2,0,"th",4)(8,Ye,2,1,"td",5),L(),V(9,6),c(10,et,2,0,"th",4)(11,tt,2,1,"td",5),L(),V(12,7),c(13,it,2,0,"th",4)(14,nt,2,1,"td",5),L(),c(15,rt,1,0,"tr",8)(16,ot,1,0,"tr",9)(17,at,3,1,"tr",10),n(),_(18,"mat-paginator",11),i(19,"button",12),f("click",function(){return d(m),u(o.refresh())}),a(20,"Refresh"),n(),c(21,lt,1,0,"app-shade-loading-spinner",13)}r&2&&(l(5),s("dataSource",o.dataSource),l(10),s("matHeaderRowDef",o.columnsToDisplay),l(),s("matRowDefColumns",o.columnsToDisplay),l(2),s("pageSizeOptions",J(5,Je)),l(3),s("ngIf",o.isLoadingResults))},dependencies:[S,M,P,A,B,Fe,ge,be,Ce,we,Se,ve,xe,ye,Me,Ee,j,H],styles:["table[_ngcontent-%COMP%]{width:100%}mat-paginator[_ngcontent-%COMP%]{width:100%}.row[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#ebebeb}"]})}}return t})();function st(t,p){t&1&&(i(0,"mat-error"),a(1," Campo "),i(2,"strong"),a(3,"requerido"),n()())}function pt(t,p){t&1&&(i(0,"mat-error"),a(1," Se supero el limite de 256 caracteres "),n())}function ct(t,p){t&1&&(i(0,"mat-error"),a(1," Se supero el limite de 512 caracteres "),n())}function dt(t,p){t&1&&(i(0,"mat-error"),a(1," Campo "),i(2,"strong"),a(3,"requerido"),n()())}function ut(t,p){if(t&1&&(i(0,"mat-option",15),a(1),n()),t&2){let e=p.$implicit;s("value",e.value),l(),k(" ",e.label," ")}}function ft(t,p){t&1&&(i(0,"mat-error"),a(1," Campo "),i(2,"strong"),a(3,"requerido"),n()())}function _t(t,p){t&1&&_(0,"app-shade-loading-spinner")}var ze=(()=>{class t{constructor(e){this.filesServ=e,this.newFileForm=new oe({name:new I("",[y.required,y.maxLength(256)]),description:new I("",[y.maxLength(512)]),year:new I("",[y.required]),fileType:new I("",[y.required])}),this.selectedFile=null,this.fileTouched=!1,this.clearFormEnabled=!1,this.types=[{label:"Inscripciones de alumnos",value:"student-inscriptions"},{label:"Beneficiarios de becas Manuel Belgrano",value:"student-scholarships-belgrano"},{label:"Beneficiarios de becas Progresar",value:"student-scholarships-progresar"}],this.uploading=!1}ngOnInit(){}onFileSelected(e){e.target.files[0].size>q?(this.selectedFile=null,alert("El archivo seleccionado supera los 25 MiB")):(this.selectedFile=e.target.files[0]??null,this.fileTouched=!0)}onSubmit(){this.uploading=!0;let e=new FormData;e.append("name",this.newFileForm.value.name??""),this.newFileForm.value.description&&e.append("description",this.newFileForm.value.description),e.append("type",this.newFileForm.value.fileType??""),e.append("year",this.newFileForm.value.year??""),e.append("uploaded_file",this.selectedFile),this.filesServ.uploadFile(e).subscribe({next:()=>{},error:r=>{this.uploading=!1,r.status==409?window.alert("Existe un conflicto con un archivo ya existente de mismo tipo o a\xF1o"):window.alert("Hubo un error al subir el archivo")},complete:()=>{this.uploading=!1,window.alert("Archivo cargado"),this.newFileCommand.next("new"),this.clearFormEnabled=!0}})}aFileWasSelected(){return this.selectedFile!=null}clearForm(){this.clearFormEnabled=!1,this.selectedFile=null,this.newFileForm.reset()}static{this.\u0275fac=function(r){return new(r||t)(w(E))}}static{this.\u0275cmp=v({type:t,selectors:[["app-new-file"]],inputs:{newFileCommand:"newFileCommand"},decls:37,vars:11,consts:[["fileInput",""],[3,"ngSubmit","formGroup"],["formControlName","name","type","text","matInput","","placeholder","Nombre del archivo"],[4,"ngIf"],["appearance","outline"],["formControlName","description","type","text","matInput",""],["formControlName","year","type","number","matInput","","placeholder","20xx"],["formControlName","fileType","panelClass","custom-select-panel"],[3,"value",4,"ngFor","ngForOf"],[1,"bottom-controls"],["type","button","mat-raised-button","",1,"chooseFileButton",3,"click"],["hidden","","type","file","accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.xlsx",3,"change"],[1,"file-name"],["type","button","mat-raised-button","","color","warn",3,"click","disabled"],["mat-button","","type","submit",1,"submitButton",3,"disabled"],[3,"value"]],template:function(r,o){if(r&1){let m=x();i(0,"form",1),f("ngSubmit",function(){return d(m),u(o.onSubmit())}),i(1,"mat-form-field")(2,"mat-label"),a(3,"Nombre"),n(),_(4,"input",2),c(5,st,4,0,"mat-error",3)(6,pt,2,0,"mat-error",3),n(),i(7,"mat-form-field",4)(8,"mat-label"),a(9,"Descripcion"),n(),_(10,"textarea",5),c(11,ct,2,0,"mat-error",3),n(),i(12,"mat-form-field")(13,"mat-label"),a(14,"a\xF1o"),n(),_(15,"input",6),c(16,dt,4,0,"mat-error",3),n(),i(17,"mat-form-field")(18,"mat-label"),a(19,"Tipo de archivo"),n(),i(20,"mat-select",7),c(21,ut,2,2,"mat-option",8),n()(),i(22,"div",9)(23,"div")(24,"button",10),f("click",function(){d(m);let C=b(27);return u(C.click())}),a(25," Elegir archivo * "),n(),i(26,"input",11,0),f("change",function(C){return d(m),u(o.onFileSelected(C))}),n(),c(28,ft,4,0,"mat-error",3),i(29,"span",12),a(30),n()(),i(31,"button",13),f("click",function(){return d(m),u(o.clearForm())}),a(32," Limpiar campos "),n()(),_(33,"mat-divider"),i(34,"button",14),a(35," Subir "),n()(),c(36,_t,1,0,"app-shade-loading-spinner",3)}if(r&2){let m,g,C,X;s("formGroup",o.newFileForm),l(5),s("ngIf",(m=o.newFileForm.get("name"))==null?null:m.hasError("required")),l(),s("ngIf",(g=o.newFileForm.get("name"))==null?null:g.hasError("maxlength")),l(5),s("ngIf",(C=o.newFileForm.get("description"))==null?null:C.hasError("maxlength")),l(5),s("ngIf",(X=o.newFileForm.get("year"))==null?null:X.hasError("required")),l(5),s("ngForOf",o.types),l(7),s("ngIf",o.fileTouched&&o.selectedFile==null),l(2),F(o.selectedFile==null?null:o.selectedFile.name),l(),s("disabled",!o.clearFormEnabled),l(3),s("disabled",o.newFileForm.invalid||!o.aFileWasSelected()),l(2),s("ngIf",o.uploading)}},dependencies:[K,S,ae,ie,le,ne,re,me,se,M,de,P,A,B,he,Te,ce,H],styles:["[_nghost-%COMP%]{position:relative}form[_ngcontent-%COMP%]{width:80%;margin:auto}mat-form-field[_ngcontent-%COMP%]{width:100%}.file-name[_ngcontent-%COMP%]{margin-left:10px}.bottom-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between}mat-divider[_ngcontent-%COMP%]{margin:20px 0}"]})}}return t})();function wt(t,p){t&1&&(i(0,"mat-icon"),a(1,"storage"),n(),a(2," Lista de archivos "))}function gt(t,p){t&1&&(i(0,"mat-icon"),a(1,"note_add"),n(),a(2," Subir nuevo "))}var Ge=(()=>{class t{constructor(){this.newFileCommand=new Z}ngOnInit(){}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=v({type:t,selectors:[["app-files"]],decls:7,vars:2,consts:[["mat-align-tabs","center","dynamicHeight",""],["mat-tab-label",""],[3,"newFileEvent"],[3,"newFileCommand"]],template:function(r,o){r&1&&(i(0,"mat-tab-group",0)(1,"mat-tab"),c(2,wt,3,0,"ng-template",1),_(3,"app-file-list",2),n(),i(4,"mat-tab"),c(5,gt,3,0,"ng-template",1),_(6,"app-new-file",3),n()()),r&2&&(l(3),s("newFileEvent",o.newFileCommand.asObservable()),l(3),s("newFileCommand",o.newFileCommand))},dependencies:[O,Ne,Ve,Le,He,ze]})}}return t})();function Ct(t,p){if(t&1){let e=x();i(0,"div")(1,"span",10),a(2),n(),i(3,"button",11),f("click",function(){d(e);let o=b(6);return u(o.click())}),a(4," Actualizar archivo "),n(),i(5,"input",12,0),f("change",function(o){d(e);let m=h(2);return u(m.onFileSelected(o))}),n()()}if(t&2){let e=h(2);l(2),F(e.selectedFile==null?null:e.selectedFile.name)}}function vt(t,p){if(t&1){let e=x();i(0,"mat-card",2)(1,"mat-card-title"),a(2,"Detalles del archivo "),i(3,"app-editable-text-field",3),f("wasModified",function(o){d(e);let m=h();return u(m.nameModified(o))}),n()(),i(4,"mat-card-content")(5,"h2"),a(6,"Descripcion"),n(),i(7,"p",4)(8,"app-editable-text-field",5),f("wasModified",function(o){d(e);let m=h();return u(m.descriptionModified(o))}),n()(),c(9,Ct,7,1,"div",6),i(10,"h2"),a(11,"Tipo"),n(),i(12,"p"),a(13),n(),i(14,"h2"),a(15,"Fecha de creaci\xF3n"),n(),i(16,"p"),a(17),$(18,"date"),n(),i(19,"h2"),a(20,"Ultima actualizaci\xF3n"),n(),i(21,"p"),a(22),$(23,"date"),n(),i(24,"button",7),f("click",function(){d(e);let o=h();return u(o.openDeleteDialog())}),i(25,"mat-icon",8),a(26,"delete"),n(),a(27," Borrar "),n(),i(28,"button",9),f("click",function(){d(e);let o=h();return u(o.downloadFile())}),i(29,"mat-icon",8),a(30,"download"),n(),a(31," Descargar "),n()()()}if(t&2){let e=h();l(3),s("isTextArea",!1)("value",e.file.name),l(5),s("isTextArea",!0)("value",e.file.description)("alternativeValue","Sin descripcion"),l(),s("ngIf",e.file.type==="student-scholarships-progresar"||e.file.type==="student-scholarships-belgrano"),l(4),F(e.file.type),l(4),F(U(18,9,e.file.createdAt,"medium")),l(5),F(U(23,12,e.file.updatedAt,"medium"))}}var Qe=(()=>{class t{constructor(e,r,o,m){this.actRoute=e,this.filesServ=r,this.dialog=o,this.router=m,this.editMode=!1,this.selectedFile=null}ngOnInit(){this.actRoute.params.subscribe({next:e=>{this.requestFileData(e)},error:()=>{},complete:()=>{}})}requestFileData(e){this.filesServ.getFile(e.id).subscribe({next:r=>{this.file=r.result},error:()=>{},complete:()=>{}})}descriptionModified(e){this.file.description=e,this.filesServ.patchFile(this.file._id,{description:e}).subscribe(r=>{this.file=r.result})}nameModified(e){this.file.name=e,this.filesServ.patchFile(this.file._id,{name:e}).subscribe(r=>{this.file=r.result})}onFileSelected(e){e.target.files[0].size>q?(this.selectedFile=null,alert("El archivo seleccionado supera los 25 MiB")):this.selectedFile=e.target.files[0]??null}updateFile(){if(this.selectedFile!=null){let e=new FormData;e.append("name",this.file.name),e.append("type",this.file.type),e.append("year",this.file.year),e.append("uploaded_file",this.selectedFile),this.filesServ.updateScholarshipsFile(e).subscribe({next:r=>{this.file=r.result},error:r=>{window.alert("Hubo un error al actualizar el archivo")},complete:()=>{window.alert("Archivo actualizado"),this.selectedFile=null}})}}openDeleteDialog(){let e=this.dialog.open(Oe);e.componentInstance.title=`\xBFBorrar el archivo ${this.file.name}?`,e.componentInstance.op1="Borrar",e.componentInstance.op2="Cancelar",e.componentInstance.result.subscribe(r=>{r=="Borrar"?this.filesServ.deleteFile(this.file._id).subscribe({next:()=>{},error:()=>{window.alert("No se pudo eliminar el archivo"),e.close()},complete:()=>{e.close(),this.router.navigate(["home","files"])}}):e.close()})}downloadFile(){this.filesServ.downloadFile(this.file._id).subscribe({next:e=>{let r=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(r),m=document.createElement("a");m.href=o,m.download=this.file.name+".xlsx",m.click(),window.alert('Se descargo el archivo "'+this.file.name+'.xlsx"')},error:()=>{window.alert('Hubo un error al descargar "'+this.file.name+'.xlsx"')},complete:()=>{}})}static{this.\u0275fac=function(r){return new(r||t)(w(te),w(E),w(ke),w(R))}}static{this.\u0275cmp=v({type:t,selectors:[["app-file-details"]],decls:1,vars:1,consts:[["fileInput",""],["appearance","outlined",4,"ngIf"],["appearance","outlined"],[3,"wasModified","isTextArea","value"],[2,"white-space","pre-wrap"],[3,"wasModified","isTextArea","value","alternativeValue"],[4,"ngIf"],["mat-raised-button","",2,"color","red",3,"click"],["color","warn"],["mat-raised-button","",3,"click"],[1,"file-name"],["type","button","mat-raised-button","",1,"chooseFileButton",3,"click"],["hidden","","type","file","accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.xlsx",3,"change"]],template:function(r,o){r&1&&c(0,vt,32,15,"mat-card",1),r&2&&s("ngIf",o.file)},dependencies:[S,M,O,ue,_e,fe,Be,Y],styles:["mat-card-content[_ngcontent-%COMP%]{padding-left:1rem}"]})}}return t})();var xt=[{path:"",component:Ge},{path:":id",component:Qe}],$e=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=N({type:t})}static{this.\u0275inj=T({imports:[W.forChild(xt),W]})}}return t})();var ai=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=N({type:t})}static{this.\u0275inj=T({imports:[ee,$e,pe,Re,Ae]})}}return t})();export{ai as FilesModule};
