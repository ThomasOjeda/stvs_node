import{a as qe}from"./chunk-7BKYMTEO.js";import{c as je,d as Pe,e as Be,g as Qe,h as He}from"./chunk-X3P6VRX6.js";import{$ as V,A as r,Aa as oe,Ab as Q,B as u,C as E,Cb as Te,D as y,Da as ae,Db as Fe,Eb as Re,F as I,Fa as se,Fb as Ne,G as _,Gb as Le,H as v,Ha as me,Hb as Oe,I as D,Ib as Ve,J as T,K as F,L as W,Lb as H,M as o,N as f,O as b,Pa as le,Qa as M,S as X,Sb as ke,U as G,Ub as $,V as A,Wa as q,Xa as pe,aa as S,ab as de,bb as ce,ca as Y,cb as ue,d as K,ea as Z,fb as fe,gb as j,h as L,hb as _e,j as h,jb as P,k as O,kb as B,mb as ge,n as C,na as ee,nb as he,o as w,ob as Ce,pa as k,pb as we,qb as ve,rb as be,s,sa as z,sb as Se,t as c,ta as te,tb as xe,ua as x,ub as Ue,va as ie,vb as Me,w as d,wa as re,wb as Ee,x as p,xa as ne,xb as ye,ya as U,yb as Ie,z as i,zb as De}from"./chunk-XFNI64LT.js";var Ze=["tagInput"];function et(e,m){e&1&&(i(0,"mat-error"),o(1," Ingrese un email valido "),r())}function tt(e,m){e&1&&(i(0,"mat-error"),o(1," Campo "),i(2,"strong"),o(3,"requerido"),r()())}function it(e,m){e&1&&(i(0,"mat-error"),o(1," Campo "),i(2,"strong"),o(3,"requerido"),r()())}function rt(e,m){e&1&&(i(0,"mat-error"),o(1," Campo "),i(2,"strong"),o(3,"requerido"),r()())}function nt(e,m){if(e&1&&(i(0,"mat-option",12),o(1),r()),e&2){let t=m.$implicit;p("value",t._id),s(),f(t._id)}}function ot(e,m){if(e&1&&(i(0,"mat-radio-button",13),o(1),r()),e&2){let t=m.$implicit;p("value",t),s(),b(" ",t," ")}}var Ae=(()=>{class e{constructor(t,n){this.authServ=t,this.tagsServ=n,this.newUserForm=new ne({email:new U("",[x.required,x.email]),password:new U("",[x.required]),username:new U("",[x.required]),tags:new U([]),role:new U("reader",[x.required])}),this.allTags=[],this.allRoles=["reader","admin"],this.clearFormEnabled=!1,n.getTags().subscribe({next:a=>{if(a.result.length>0){this.allTags=a.result;let l=this.allTags.findIndex(g=>g._id=="PUBLIC");if(l!=-1){let g=this.allTags[l];this.allTags.splice(l,1),this.allTags.unshift(g)}}else this.allTags=[]},error:a=>{},complete:()=>{}})}ngOnInit(){}onSubmit(){this.authServ.registerUser(this.newUserForm.value).subscribe({next:t=>{},error:t=>{t.status==409&&window.alert("No se ha podido registrar el usuario. Existe un usuario registrado con la misma direcci\xF3n de correo.")},complete:()=>{window.alert("Registrado"),this.newUserCommand.next("new"),this.clearFormEnabled=!0}})}clearForm(){this.clearFormEnabled=!1,this.newUserForm.reset()}static{this.\u0275fac=function(n){return new(n||e)(c(qe),c(je))}}static{this.\u0275cmp=h({type:e,selectors:[["app-new-user"]],viewQuery:function(n,a){if(n&1&&D(Ze,5),n&2){let l;T(l=F())&&(a.tagInput=l.first)}},inputs:{newUserCommand:"newUserCommand"},decls:32,vars:9,consts:[[3,"ngSubmit","formGroup"],["formControlName","email","type","email","matInput","","placeholder","Ej. usuario@ejemplo.com"],[4,"ngIf"],["formControlName","password","type","password","matInput","","placeholder","***********************"],["formControlName","username","type","text","matInput","","placeholder","usuario ejemplo"],["panelClass","custom-select-panel","formControlName","tags","multiple",""],[3,"value",4,"ngFor","ngForOf"],["color","primary","formControlName","role",1,"radio-group"],["class","radio-button",3,"value",4,"ngFor","ngForOf"],[1,"clear-control"],["type","button","mat-raised-button","","color","warn",3,"click","disabled"],["mat-button","","type","submit",3,"disabled"],[3,"value"],[1,"radio-button",3,"value"]],template:function(n,a){if(n&1&&(i(0,"form",0),_("ngSubmit",function(){return a.onSubmit()}),i(1,"mat-form-field")(2,"mat-label"),o(3,"email"),r(),u(4,"input",1),d(5,et,2,0,"mat-error",2)(6,tt,4,0,"mat-error",2),r(),i(7,"mat-form-field")(8,"mat-label"),o(9,"contrase\xF1a"),r(),u(10,"input",3),d(11,it,4,0,"mat-error",2),r(),i(12,"mat-form-field")(13,"mat-label"),o(14,"nombre de usuario"),r(),u(15,"input",4),d(16,rt,4,0,"mat-error",2),r(),i(17,"mat-form-field")(18,"mat-label"),o(19,"Etiquetas"),r(),i(20,"mat-select",5),d(21,nt,2,2,"mat-option",6),r()(),i(22,"label"),o(23,"Rol"),r(),i(24,"mat-radio-group",7),d(25,ot,2,2,"mat-radio-button",8),r(),i(26,"div",9)(27,"button",10),_("click",function(){return a.clearForm()}),o(28," Limpiar campos "),r()(),u(29,"mat-divider"),i(30,"button",11),o(31," Registrar "),r()()),n&2){let l,g,N,J;p("formGroup",a.newUserForm),s(5),p("ngIf",((l=a.newUserForm.get("email"))==null?null:l.hasError("email"))&&!((l=a.newUserForm.get("email"))!=null&&l.hasError("required"))),s(),p("ngIf",(g=a.newUserForm.get("email"))==null?null:g.hasError("required")),s(5),p("ngIf",(N=a.newUserForm.get("password"))==null?null:N.hasError("required")),s(5),p("ngIf",(J=a.newUserForm.get("username"))==null?null:J.hasError("required")),s(5),p("ngForOf",a.allTags),s(4),p("ngForOf",a.allRoles),s(2),p("disabled",!a.clearFormEnabled),s(3),p("disabled",a.newUserForm.invalid)}},dependencies:[V,S,oe,te,ie,re,ae,se,M,pe,B,P,j,_e,Oe,Ve,De,le],styles:["form[_ngcontent-%COMP%]{width:80%;margin:auto}mat-form-field[_ngcontent-%COMP%]{width:100%}.radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0;align-items:flex-start}.radio-button[_ngcontent-%COMP%]{margin:5px}mat-divider[_ngcontent-%COMP%]{margin:20px 0}.clear-control[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})}}return e})();function dt(e,m){if(e&1){let t=I();i(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),o(3),r()(),i(4,"mat-card-content")(5,"h2"),o(6,"Email"),r(),i(7,"p"),o(8),r(),i(9,"h2"),o(10,"Fecha de creaci\xF3n"),r(),i(11,"p"),o(12),G(13,"date"),r(),i(14,"h2"),o(15,"Ultima actualizaci\xF3n"),r(),i(16,"p"),o(17),G(18,"date"),r(),i(19,"h2"),o(20,"Tags"),r(),i(21,"p")(22,"app-modifiable-tags",2),_("wasModified",function(a){C(t);let l=v();return w(l.tagsModified(a))}),r()(),i(23,"button",3),_("click",function(){C(t);let a=v();return w(a.openDeleteDialog())}),i(24,"mat-icon",4),o(25,"delete"),r(),o(26," Borrar "),r()()()}if(e&2){let t=v();s(3),b('Detalles del usuario "',t.user.username,'"'),s(5),f(t.user.email),s(4),f(A(13,5,t.user.createdAt)),s(5),f(A(18,7,t.user.updatedAt)),s(5),p("tags",t.user.tags)}}var ze=(()=>{class e{constructor(t,n,a,l){this.actRoute=t,this.usersServ=n,this.dialog=a,this.router=l}ngOnInit(){this.actRoute.params.subscribe({next:t=>{this.requestUserData(t)},error:()=>{},complete:()=>{}})}requestUserData(t){this.usersServ.getUser(t.id).subscribe({next:n=>{this.handleUserData(n)},error:()=>{},complete:()=>{}})}handleUserData(t){this.user=t.result}openDeleteDialog(){let t=this.dialog.open(Be);t.componentInstance.title=`\xBFBorrar el usuario ${this.user.username}?`,t.componentInstance.op1="Borrar",t.componentInstance.op2="Cancelar",t.componentInstance.result.subscribe(n=>{n=="Borrar"?this.usersServ.deleteUser(this.user._id).subscribe({next:()=>{},error:()=>{window.alert("No se pudo eliminar el usuario"),t.close()},complete:()=>{t.close(),this.router.navigate(["home","users"])}}):t.close()})}tagsModified(t){this.user.tags=t,this.usersServ.updateUser(this.user._id,this.user).subscribe(n=>{this.user=n.result})}static{this.\u0275fac=function(n){return new(n||e)(c(ee),c($),c(H),c(k))}}static{this.\u0275cmp=h({type:e,selectors:[["app-user-details"]],decls:1,vars:1,consts:[["appearance","outlined",4,"ngIf"],["appearance","outlined"],[3,"wasModified","tags"],["mat-raised-button","",2,"color","red",3,"click"],["color","warn"]],template:function(n,a){n&1&&d(0,dt,27,9,"mat-card",0),n&2&&p("ngIf",a.user)},dependencies:[S,M,q,de,ue,fe,ce,Qe,Y],styles:[".mat-mdc-card-content[_ngcontent-%COMP%]{padding-left:1rem}"]})}}return e})();var ct=()=>[15,30,45];function ut(e,m){e&1&&(i(0,"th",16),o(1,"Nombre de usuario"),r())}function ft(e,m){if(e&1&&(i(0,"td",17),o(1),r()),e&2){let t=m.$implicit;s(),f(t.username)}}function _t(e,m){e&1&&(i(0,"th",16),o(1,"Email"),r())}function gt(e,m){if(e&1&&(i(0,"td",17),o(1),r()),e&2){let t=m.$implicit;s(),f(t.email)}}function ht(e,m){e&1&&(i(0,"th",16),o(1,"Rol"),r())}function Ct(e,m){if(e&1&&(i(0,"td",17),o(1),r()),e&2){let t=m.$implicit;s(),f(t.role)}}function wt(e,m){e&1&&(i(0,"th",16),o(1,"Etiquetas"),r())}function vt(e,m){if(e&1&&(i(0,"div")(1,"mat-chip-option"),o(2),r()()),e&2){let t=m.$implicit;s(2),f(t)}}function bt(e,m){if(e&1&&(i(0,"td",17)(1,"mat-chip-listbox",18),d(2,vt,3,1,"div",19),r()()),e&2){let t=m.$implicit;s(2),p("ngForOf",t.tags)}}function St(e,m){e&1&&u(0,"tr",20)}function xt(e,m){if(e&1){let t=I();i(0,"tr",21),_("click",function(){let a=C(t).$implicit,l=v();return w(l.openDetails(a))}),r()}}function Ut(e,m){if(e&1&&(i(0,"tr",22)(1,"td",23),o(2),r()()),e&2){v();let t=W(4);s(2),b(' No se encontro un usuario con el filtro "',t.value,'" ')}}function Mt(e,m){e&1&&u(0,"app-shade-loading-spinner")}var Je=(()=>{class e{constructor(t,n,a){this.usersServ=t,this.router=n,this.dialog=a,this.columnsToDisplay=["username","role","tags"],this.isLoadingResults=!0}ngOnInit(){this.userEventSubscription=this.newUserEvent.subscribe(t=>{t=="new"&&this.refresh()})}ngAfterViewInit(){this.dataSource=new ye,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.refresh()}refresh(){this.isLoadingResults=!0,this.usersServ.getUsers().subscribe({next:t=>{this.dataSource.data=t.result},error:()=>{this.isLoadingResults=!1},complete:()=>{this.isLoadingResults=!1}})}applyFilter(t){let n=t.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}openDetails(t){this.router.navigate(["home","users",t._id])}ngOnDestroy(){this.userEventSubscription.unsubscribe()}static{this.\u0275fac=function(n){return new(n||e)(c($),c(k),c(H))}}static{this.\u0275cmp=h({type:e,selectors:[["app-user-list"]],viewQuery:function(n,a){if(n&1&&(D(Q,5),D(Ie,5)),n&2){let l;T(l=F())&&(a.paginator=l.first),T(l=F())&&(a.sort=l.first)}},inputs:{newUserEvent:"newUserEvent"},decls:25,vars:6,consts:[["input",""],[1,"filter"],["matInput","",3,"keyup"],["mat-table","",3,"dataSource"],["matColumnDef","username"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","role"],["matColumnDef","tags"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","row",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Seleccione pagina de usuarios",3,"pageSizeOptions"],["mat-button","",3,"click"],[4,"ngIf"],["mat-header-cell",""],["mat-cell",""],["aria-label","Etiquetas","disabled","true"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row","",1,"row",3,"click"],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(n,a){if(n&1){let l=I();i(0,"mat-form-field",1)(1,"mat-label"),o(2,"Filtrar"),r(),i(3,"input",2,0),_("keyup",function(N){return C(l),w(a.applyFilter(N))}),r()(),i(5,"table",3),E(6,4),d(7,ut,2,0,"th",5)(8,ft,2,1,"td",6),y(),E(9,7),d(10,_t,2,0,"th",5)(11,gt,2,1,"td",6),y(),E(12,8),d(13,ht,2,0,"th",5)(14,Ct,2,1,"td",6),y(),E(15,9),d(16,wt,2,0,"th",5)(17,bt,3,1,"td",6),y(),d(18,St,1,0,"tr",10)(19,xt,1,0,"tr",11)(20,Ut,3,1,"tr",12),r(),u(21,"mat-paginator",13),i(22,"button",14),_("click",function(){return C(l),w(a.refresh())}),o(23,"Refresh"),r(),d(24,Mt,1,0,"app-shade-loading-spinner",15)}n&2&&(s(5),p("dataSource",a.dataSource),s(13),p("matHeaderRowDef",a.columnsToDisplay),s(),p("matRowDefColumns",a.columnsToDisplay),s(2),p("pageSizeOptions",X(5,ct)),s(3),p("ngIf",a.isLoadingResults))},dependencies:[V,S,M,B,P,j,ge,Ce,Se,we,he,xe,ve,be,Ue,Me,Ee,Q,Fe,Te,Pe],styles:["[_nghost-%COMP%]{position:relative;width:100%;display:block}table[_ngcontent-%COMP%]{width:100%}mat-paginator[_ngcontent-%COMP%]{width:100%}.filter[_ngcontent-%COMP%]{display:block;width:200px}.row[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#ebebeb}"]})}}return e})();function yt(e,m){e&1&&(i(0,"mat-icon"),o(1,"person_add"),r(),o(2," Crear nuevo "))}function It(e,m){e&1&&(i(0,"mat-icon"),o(1,"group"),r(),o(2," Lista de usuarios "))}var Ke=(()=>{class e{constructor(){this.newUserCommand=new K}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=h({type:e,selectors:[["app-users"]],decls:7,vars:2,consts:[["mat-align-tabs","center","dynamicHeight",""],["mat-tab-label",""],[3,"newUserCommand"],[3,"newUserEvent"]],template:function(n,a){n&1&&(i(0,"mat-tab-group",0)(1,"mat-tab"),d(2,yt,3,0,"ng-template",1),u(3,"app-new-user",2),r(),i(4,"mat-tab"),d(5,It,3,0,"ng-template",1),u(6,"app-user-list",3),r()()),n&2&&(s(3),p("newUserCommand",a.newUserCommand),s(3),p("newUserEvent",a.newUserCommand.asObservable()))},dependencies:[q,Re,Ne,Le,Ae,Je]})}}return e})();var Dt=[{path:"",component:Ke},{path:":id",component:ze}],We=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=O({type:e})}static{this.\u0275inj=L({imports:[z.forChild(Dt),z]})}}return e})();var _i=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=O({type:e})}static{this.\u0275inj=L({imports:[Z,We,me,ke,He]})}}return e})();export{_i as UsersModule};
